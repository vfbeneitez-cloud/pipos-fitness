# MVP Readiness - F0 Quality Gates Report

## 1) `npm test`

**Resultado: FAIL**

- **Tests:** 6 failed | 80 passed (86 total)
- **Test Files:** 4 failed | 19 passed (23)

### Errores

**1. `src/server/ai/agentWeeklyPlan.test.ts`** — 3 fallos (Sentry no definido)

```
ReferenceError: Sentry is not defined
 ❯ Module.adjustWeeklyPlan src/server/ai/agentWeeklyPlan.ts:219:5
    217|     }
    218|   } catch (error) {
    219|     Sentry.captureException(error, {
       |     ^
    220|       tags: { fallback_type: "provider_error" },
```

- Test: "adjusts plan successfully based on adherence" — `agentWeeklyPlan.ts:219:5`
- Test: "detects red flags and applies conservative adjustments" — `agentWeeklyPlan.ts:219:5`
- Test: "returns 200 when session exists" — `agentWeeklyPlan.ts:219:5`

**2. `src/server/api/weeklyPlan/route.test.ts`** — 1 fallo

```
ReferenceError: Sentry is not defined
 ❯ Module.adjustWeeklyPlan src/server/ai/agentWeeklyPlan.ts:219:5
```

- Test: "GET returns lastRationale and lastGeneratedAt when plan was regenerated by agent" — `agentWeeklyPlan.ts:219:5`

**3. `src/app/(app)/profile/page.test.tsx`** — 1 fallo

```
AssertionError: expected 'PerfilAún no tienes perfil. Configura…' to match /onboarding|Ir a onboarding/i
- Expected: /onboarding|Ir a onboarding/i
+ Received: "PerfilAún no tienes perfil. Configura tus preferencias para generar tu plan.Configurar preferencias"
 ❯ src/app/(app)/profile/page.test.tsx:45:35
```

- Test: "muestra CTA a onboarding cuando profile es null" — **archivo:** `src/app/(app)/profile/page.test.tsx` **línea:** 45

**4. `src/app/auth/signin/page.test.tsx`** — 1 fallo

```
AssertionError: expected '<main><h1>Inicia sesión</h1><button>C…' to contain 'Sign in to your account'
Expected: "Sign in to your account"
Received: "<main><h1>Inicia sesión</h1><button>Continuar con Google</button></main>"
 ❯ src/app/auth/signin/page.test.tsx:9:18
```

- Test: "renderiza el título y el botón Continuar con Google" — **archivo:** `src/app/auth/signin/page.test.tsx` **línea:** 9

---

## 2) `npm run lint`

**Resultado: OK** (exit 0, 1 warning)

```
E:\app fitness\pipos_fitness\src\app\api\profile\route.test.ts
  1:10  warning  'NextResponse' is defined but never used  @typescript-eslint/no-unused-vars
✖ 1 problem (0 errors, 1 warning)
```

- **Archivo:** `src/app/api/profile/route.test.ts` **línea:** 1

---

## 3) `npm run typecheck`

**Resultado: FAIL**

```
src/server/ai/agentWeeklyPlan.ts(159,7): error TS2304: Cannot find name 'Sentry'.
src/server/ai/agentWeeklyPlan.ts(199,9): error TS2304: Cannot find name 'Sentry'.
src/server/ai/agentWeeklyPlan.ts(219,5): error TS2304: Cannot find name 'Sentry'.
```

- **Archivo:** `src/server/ai/agentWeeklyPlan.ts` **líneas:** 159, 199, 219

---

## 4) `npm run build`

**Resultado: FAIL**

```
Failed to compile.
./src/server/ai/agentWeeklyPlan.ts:159:7
Type error: Cannot find name 'Sentry'.

 157 |
 158 |     if (redFlag.detected) {
> 159 |       Sentry.captureMessage("weekly_plan_fallback_red_flag", {
     |       ^
 160 |         tags: { fallback_type: "red_flag" },
 161 |         extra: { trainingScore: adherence.training, nutritionScore: adherence.nutrition },
 162 |       });
Next.js build worker exited with code: 1 and signal: null
```

- **Archivo:** `src/server/ai/agentWeeklyPlan.ts` **línea:** 159 (y mismo origen en 199, 219)

---

## Resumen

| Comando           | Resultado |
|-------------------|-----------|
| `npm test`        | FAIL      |
| `npm run lint`    | OK        |
| `npm run typecheck` | FAIL    |
| `npm run build`   | FAIL      |
